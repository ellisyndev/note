# âœ… Laradock + Nginx + Cloudflare + SSL å¿«é€ŸæˆåŠŸéƒ¨ç½²æ‡¶äººåŒ…

é€™æ˜¯é‡å°éƒ¨ç½² Laravel å°ˆæ¡ˆåˆ° AWS EC2ï¼Œä¸¦é€é Cloudflare ä½¿ç”¨é€šé…ç¬¦ SSL æ†‘è­‰çš„å®Œæ•´éƒ¨ç½²æµç¨‹æ•´ç†ã€‚

---

## ğŸ§± ç’°å¢ƒå‰æ

- å°ˆæ¡ˆæ¶æ§‹ä½¿ç”¨ [Laradock](https://laradock.io/)
- EC2 Ubuntu ç’°å¢ƒ
- Nginx ä½œç‚º Web Server
- ç¶²åŸŸè¨»å†Šåœ¨ Cloudflareï¼Œä½¿ç”¨å…è²»é€šé…ç¬¦æ†‘è­‰ï¼ˆ*.example.comï¼‰

---

## ğŸ“¦ æ­¥é©Ÿç¸½è¦½

### 1ï¸âƒ£ è¨­å®š EC2 å®‰å…¨ç¾¤çµ„

- é–‹æ”¾å…¥ç«™è¦å‰‡ï¼ˆInbound Rulesï¼‰ï¼š

| é¡å‹  | å”å®š | åŸ ç¯„åœ | ä¾†æº       |
|-------|------|--------|------------|
| HTTP  | TCP  | 80     | 0.0.0.0/0  |
| HTTPS | TCP  | 443    | 0.0.0.0/0  |

---

### 2ï¸âƒ£ Laravel å°ˆæ¡ˆæ”¾ç½®ä½ç½®ï¼ˆç›¸å°æ–¼ Laradockï¼‰

```
/laradock
/www/your-laravel-project
```

---

### 3ï¸âƒ£ docker-compose.yml nginx volumes ç¯„ä¾‹

```yaml
services:
  nginx:
    volumes:
      - ../www/your-laravel-project:/var/www
      - ./nginx/sites:/etc/nginx/sites-available
      - ./nginx/ssl:/etc/nginx/ssl
```

---

### 4ï¸âƒ£ å»ºç«‹æ†‘è­‰æª”ï¼ˆCloudflare è‡ªç°½æˆ– Let's Encryptï¼‰

å°‡ä½ çš„æ†‘è­‰æ”¾å…¥ï¼š

```
laradock/nginx/ssl/your-domain.example.com.crt
laradock/nginx/ssl/your-domain.example.com.key
```

---

### 5ï¸âƒ£ Nginx è¨­å®šç¯„ä¾‹ï¼ˆåˆ†é–‹ HTTP èˆ‡ HTTPSï¼‰

#### HTTP â†’ HTTPS è½‰å°ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.example.com;
    return 301 https://$host$request_uri;
}
```

#### HTTPS è™•ç†ï¼š

```nginx
server {
    listen 443 ssl;
    server_name your-domain.example.com;

    ssl_certificate     /etc/nginx/ssl/your-domain.example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/your-domain.example.com.key;

    root /var/www/your-laravel-project/public;
    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_pass php-upstream;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

---

### 6ï¸âƒ£ é‡å•Ÿ nginx ä¸¦é©—è­‰è¨­å®š

```bash
docker-compose exec nginx nginx -t
docker-compose restart nginx
```

---

### 7ï¸âƒ£ Cloudflare è¨­å®š

- DNS è¨˜éŒ„ç‚º A æˆ– CNAME
- ä»£ç†ç‹€æ…‹ï¼šğŸŸ ï¼ˆProxiedï¼‰
- SSL æ¨¡å¼ï¼šå»ºè­° `Full`
- é–‹å•Ÿ Always Use HTTPSï¼šâœ…

---

## âœ… æ¸¬è©¦æ–¹å¼

```bash
curl -vk https://your-domain.example.com
```

æˆ–ï¼š

```bash
curl -vk https://your-domain.example.com --resolve your-domain.example.com:443:<EC2 IP>
```

---

## ğŸ‰ å®Œæˆï¼

ä½ å·²æˆåŠŸéƒ¨ç½² Laravel å°ˆæ¡ˆï¼Œæ”¯æ´ HTTPS èˆ‡ Cloudflare é˜²è­·ï¼
